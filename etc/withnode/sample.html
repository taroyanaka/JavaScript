<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <title>text splitter for tweet</title>
</head>

<body>
  <div>
    <input id="btn" type="button" value="makeQandA" />
  </div>
  <div>
    <textarea name="foo" id="foo" cols="20" rows="100" required="required" maxlength="100000"
      autofocus="autofocus"></textarea>
    <textarea name="bar" id="bar" cols="20" rows="100" required="required" maxlength="100000"></textarea>
    <textarea name="baz" id="baz" cols="20" rows="100" required="required" maxlength="100000"></textarea>
  </div>
  <script>
    // 配列をシャッフルする関数
    const shuffleArray = array => {
      for (let i = array.length - 1; i > 0; i--) {
        let r = Math.floor(Math.random() * (i + 1));
        let tmp = array[i];
        array[i] = array[r];
        array[r] = tmp;
      }
      return array
    }

    // reference https://qiita.com/ttatsf/items/fdb9fc5dc12af7b6cb68
    // zip関数
    const zip = xs => ys =>
      (xs.length < ys.length) ? xs.map((e, i) => [e, ys[i]])
        : ys.map((e, i) => [xs[i], e]);

    document.getElementById('foo').value =
      "built\nbought\ncaught\ncut\nfelt\nfound";
    // "built\nbought\ncaught\ncut\nfelt\nfound\nhad\nheard\nkept\nleft\nlent";
    // "built\nbought\ncaught\ncut\nfelt\nfound\nhad\nheard\nkept\nleft\nlent\nlet\nlost\nmade\nmet\nput\nread\nsaid\nsold\nsent\nsat\nslept\nspent\nstood\ntaught\ntold\nthought\nunderstand";
    document.getElementById('bar').value =
      "建てた\n買った\n捕まった\nカット\nフェルト\n見つかった";
    // "建てた\n買った\n捕まった\nカット\nフェルト\n見つかった\n持っていました\n聞いた\n守った\n左\n貸した";
    // "建てた\n買った\n捕まった\nカット\nフェルト\n見つかった\n持っていました\n聞いた\n守った\n左\n貸した\nさせて\n迷った\n製\n会った\nプット\n読む\n前記\n売った\n送られた\n座っていた\n寝た\n費やした\n立っていた\n教えた\n言った\n思想\nわかる";

    let allShutudai = [];
    allShutudai = [];
    let question = document.getElementById('foo').value.split('\n');
    let answer = document.getElementById('bar').value.split('\n');
    document.getElementById('btn').addEventListener('click', function () {
      // mondai:全部の問題。破壊的変更はしない。
      // shuffledMondai:全部の問題をシャッフルしたもの。
      // nokoriMondai:シャッフルされたあと出題ごとに配列をunshiftしていく。
      // shuffuledNokoriMondai:出題ごとに配列をunshiftしていく。
      // Q:問題文
      // seikai:Qに問題を入れたあと["ok","正解"]の形式になる
      // fuseikai:shuffledMondaiからランダムで3つ取り出したものを[["ng":"不正解"],["ng":"不正解"],["ng":"不正解"]]の形にする
      // shutudai:seikaiとfuseikaiを連結してシャッフルした結果の配列(例 [["ng":"不正解"],["ng":"不正解"],["ng":"不正解"],["ok":"正解"]]　(正解の配列の要素の位置はランダム)になっている)
      // mondai = zip(question)(answer);
      // mondai = document.getElementById('baz').value.split("\n");

      // 全問題から回答して減っていく問題の配列をコピー(参照渡しではないのでArray.from)
      mondai = zip(question)(answer);
      shuffuledNokoriMondai = shuffleArray(Array.from(mondai))

      // 問題数分の出題を繰り返す
      num = shuffuledNokoriMondai.length
      for (let i = 0; i < num; i++) {
        // 1問分取り出す
        seikai = Array.from(shuffuledNokoriMondai.splice(0, 1))

        // ランダムで正解とかぶってない配列だけを3つ取り出して不正解の配列を作る
        shuffledMondai = Array.from(shuffleArray(mondai))
        fuseikai = Array.from(shuffledMondai.filter(v => v !== seikai[0]))
        // randomFuseikai = fuseikai.splice(0, 3)
        // randomFuseikai.map(v => v[0] = "ng")

        // 問題文を作って、正解の配列を作って、出題の配列をランダムで作る
        // Q = seikai[0][0]
        // seikai[0][0] = "ok"
        // shutudai = shuffleArray(randomFuseikai.concat(seikai))

        // 問題の配列を作る
        // for (let a of shutudai) { allShutudai.push([Q, a]) }
        // allShutudai.push(randomFuseikai.concat(seikai))
        allShutudai.push([fuseikai.splice(0, 3), seikai[0]])
        // console.log([Q, shutudai])


        // "ok"から元の["問題","回答"]の状態に戻す
        // seikai[0][0] = Q
      }
    }, false);


      // while (bar.length !== 0) { if (bar.length === 0) { break } res.push(bar.splice(0, 110)) }
      // res.map(v => joinedRes.push(v.join('')))

      // for (let dataText of joinedRes) {
      //   let a = document.createElement("a"); a.setAttribute("class", "twitter-share-button"); a.setAttribute("data-text", dataText);
      //   let script = document.createElement("script"); script.setAttribute("src", "https://platform.twitter.com/widgets.js"); script.setAttribute("charset", "utf-8");
      //   document.querySelector("body").insertBefore(a, null)
      //   document.querySelector("body").insertBefore(script, null)
      // }






    // let foo = [
    //   "up",
    //   "down",
    //   "right",
    //   "left",
    //   "tree",
    //   "fire",
    //   "dog"
    // ]
    // let bar = [
    //   "上",
    //   "下",
    //   "右",
    //   "左",
    //   "木",
    //   "火",
    //   "犬"
    // ]
    // const mondai = zip(foo)(bar);
    // const mondai = [["up", "上"], ["down", "下"], ["right", "右"], ["left", "左"], ["tree", "木"], ["fire", "火"], ["dog", "犬"]]








    // modai.push(seikai)

    // const shuffle = array => {
    //   for (var i = array.length - 1; i > 0; i--) {
    //     var r = Math.floor(Math.random() * (i + 1));
    //     var tmp = array[i];
    //     array[i] = array[r];
    //     array[r] = tmp;
    //   }
    //   return array
    // }
    // shuffledMondai = shuffle(mondai)

    // question = []
    // answer = []
    // for (let q of bar) { question.push(q[0]) }
    // for (let a of bar) { answer.push(a[1]) }
    // const shuffle = array => {
    //   for (var i = array.length - 1; i > 0; i--) {
    //     var r = Math.floor(Math.random() * (i + 1));
    //     var tmp = array[i];
    //     array[i] = array[r];
    //     array[r] = tmp;
    //   }
    //   return array
    // }


    // let getRandomIndex = (min, max) => {
    //   return Math.floor(Math.random() * (max - min + 1)) + min;
    // }
    // ok = bar.splice(getRandomIndex(min, max), 1)

    // // let original = [["up", "上"], ["down", "下"], ["right", "右"], ["left", "左"], ["tree", "木"], ["fire", "火"], ["dog", "犬"]]
    // let original = [[0, 0], [1, 1], [2, 2]]
    // let result = []
    // while (original.length !== 0) {
    //   result.push(
    //     original.splice(
    //       (
    //         Math.floor(Math.random() * (original.length - 1 - 0 + 1)) + 0)
    //       ,
    //       1
    //     )[0]
    //   )
    // }

  </script>
</body>

</html>