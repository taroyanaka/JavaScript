<!doctype html>
<html>
<head>
<title>loop youtube</title>
<script src="./easytimer.min.js"></script>
</head>
<body>
<iframe id="ytplayer" type="text/html" width="320" height="180"  src="https://www.youtube.com/embed/oGTVoX7AaRc?autoplay=1&start=865&vq=small" allow="autoplay"></iframe>
<div>
ID<input type="text" name="text0_0" id="text0_0" size="15" placeholder="oGTVoX7AaRc"></input>
start seconds<input type="text" name="text0_1" id="text0_1" size="4" placeholder="865"></input>
duration seconds(over 10 seconds)<input type="text" name="text0_2" id="text0_2" size="4" placeholder="70"></input>
</div>
<button onclick="UPDATE();">REPLAY and UPDATE NOW</button>
<div></div>
share URL<input type="text" name="text0_3" id="text0_3" size="100"></input>
</div>
</body>
<script>
let id,start,duration;
id = "oGTVoX7AaRc";
start = 865;
duration = 70;

const init = () =>{
	if(document.querySelector("#text0_0").value !== "" &&
	   document.querySelector("#text0_1").value !== "" &&
       document.querySelector("#text0_2").value !== "" &&
	   Number(document.querySelector("#text0_2").value) > 10){
			[id,start,duration] = [document.querySelector("#text0_0").value,document.querySelector("#text0_1").value,document.querySelector("#text0_2").value];
	}

	if(	(new URL(document.location)).searchParams.get('id') && (new URL(document.location)).searchParams.get('start') &&  (new URL(document.location)).searchParams.get('duration') ){
		[document.querySelector("#text0_0").value, document.querySelector("#text0_1").value, document.querySelector("#text0_2").value] =
		[id,start,duration] =
		[ (new URL(document.location)).searchParams.get('id'), (new URL(document.location)).searchParams.get('start'), (new URL(document.location)).searchParams.get('duration') ]
	}
}
init();

const TIMER = new easytimer.Timer();
TIMER.addEventListener('targetAchieved', () => 	location.reload() );
if(	(new URL(document.location)).searchParams.get('id') && (new URL(document.location)).searchParams.get('start') &&  (new URL(document.location)).searchParams.get('duration') ){
	TIMER.start({ countdown: true, startValues: {seconds: Number((new URL(document.location)).searchParams.get('duration')) }, target: { seconds: 0 }, precision: 'secondTenths' });
}
else{
	TIMER.start({ countdown: true, startValues: {seconds: Number(duration) }, target: { seconds: 0 }, precision: 'secondTenths' });
}

const shareURLupdate = () => document.querySelector("#text0_3").value = `https://taroyanaka.github.io/javascript/etc/withnode/youtubeloop.html?id=${id}&start=${start}&duration=${duration}`;

const UPDATE = () => {
	if(document.querySelector("#text0_0").value !== "" &&
	   document.querySelector("#text0_1").value !== "" &&
       document.querySelector("#text0_2").value !== "" &&
	   Number(document.querySelector("#text0_2").value) > 10){
			[id,start,duration] = [document.querySelector("#text0_0").value,document.querySelector("#text0_1").value,document.querySelector("#text0_2").value];
			location.replace(`https://taroyanaka.github.io/javascript/etc/withnode/youtubeloop.html?id=${id}&start=${start}&duration=${duration}`);
	}
	// location.replace(`http://localhost:5501/etc/withnode/youtubeloop.html?id=${id}&start=${start}&duration=${duration}`)
}

document.querySelector("#ytplayer").src = `https://www.youtube.com/embed/${id}?autoplay=1&start=${start}&vq=small`;
document.querySelector("#text0_3").value = `https://taroyanaka.github.io/javascript/etc/withnode/youtubeloop.html?id=${id}&start=${start}&duration=${duration}`;
shareURLupdate();
</script>
</html>