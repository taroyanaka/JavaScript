<!doctype html>
<html>
<head>
<title>loop youtube</title>
<!-- https://dexie.org/ -->
<!-- https://dexie.org/docs/ -->
<!-- dexie.js need dexie.js.map -->
<script src="dexie.js"></script>
<script src="./easytimer.min.js"></script>
</head>
<body>
<iframe id="ytplayer" type="text/html" width="320" height="180"  src="https://www.youtube.com/embed/oGTVoX7AaRc?autoplay=1&start=865&vq=small" allow="autoplay"></iframe>
<div>
ID<input type="text0_0" name="text0_0" id="text0_0" cols="50" rows="10" onInput="UPDATE();" placeholder="oGTVoX7AaRc"></input>
start seconds<input type="text0_1" name="text0_1" id="text0_1" cols="50" rows="10" onInput="UPDATE();" placeholder="865"></input>
duration seconds<input type="text0_2" name="text0_2" id="text0_2" cols="50" rows="10" onInput="UPDATE();" placeholder="70"></input>
</div>
<button onclick="location.reload();">REPLAY NOW</button>
<!-- <button onclick="DELETE();">DELETE</button> -->
<!-- <button onclick="location.reload();">PAGERELOAD</button> -->
</body>
<script>
// https://taroyanaka.github.io/javascript/etc/withnode/youtubeloop.html?id=qcQTKG-nrvM&start=1441&duration=95
if(		(new URL(document.location)).searchParams	){
	document.querySelector("#text0_0").value =	(new URL(document.location)).searchParams.get('id');
	document.querySelector("#text0_1").value =	(new URL(document.location)).searchParams.get('start');
	document.querySelector("#text0_2").value =	(new URL(document.location)).searchParams.get('duration');
}

let res;

const titleTagStr = document.querySelector("title").textContent.split(" ").join("");
let DB;
const CREATE = () =>{DB = new Dexie(titleTagStr);DB.version(1).stores({table0:"id,data"});};
const READ = () =>DB.table0.get(0).then((RECORD)=>{
	res=RECORD.data;
		 [document.querySelector("#text0_0").value,
			document.querySelector("#text0_1").value,
			document.querySelector("#text0_2").value,
		] = res;
	document.querySelector("#ytplayer").src = `https://www.youtube.com/embed/${res[0]}?autoplay=1&start=${res[1]}&vq=small`;
	const TIMER = new easytimer.Timer();
	TIMER.addEventListener('targetAchieved', () => 	location.reload() );
	TIMER.start({ countdown: true, startValues: {seconds: Number(res[2]) }, target: { seconds: 0 }, precision: 'secondTenths' });
});
const UPDATE = () =>{
	 res = [document.querySelector("#text0_0").value,
			document.querySelector("#text0_1").value,
			document.querySelector("#text0_2").value,
	    	 ]
	document.querySelector("#ytplayer").src = `https://www.youtube.com/embed/${res[0]}?autoplay=1&start=${res[1]}&vq=small`;
	DB.table0.put({id:0,data:res})
}
const DELETE = () =>Dexie.delete(titleTagStr);
CREATE();
READ();
</script>
</html>