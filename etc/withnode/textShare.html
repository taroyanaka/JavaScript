<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>textShare</title>
<!-- https://github.com/davidshimjs/qrcodejs -->
<script src="qrcode.js"></script>
<meta name="viewport" content="width=device-width">
</head>
<body style="background-color: gray">
<textarea name="textField" id="textField" cols="50" rows="10" required="required" maxlength="2000" autofocus="autofocus" style="font-size: 16px;transform: scale(0.9);"></textarea>
<a target="_blank" rel="noopener noreferrer" href="https://script.google.com/macros/s/AKfycbyhMMEzWxNMmxZzyn8f9ot2YdROT9UThZeba_an3YDun2F0hot2/exec?value=foo" onclick="textShare()">Share</a>
<div id="qrcode" style="width:200px; height:200px; margin-top:15px;"></div>
<script>
const textShare = () =>{
	const query = encodeURIComponent(document.querySelector(`#textField`).value);
	const URL = document.querySelector("a").href = "https://script.google.com/macros/s/AKfycbyhMMEzWxNMmxZzyn8f9ot2YdROT9UThZeba_an3YDun2F0hot2/exec?value=" + query;
	console.log(URL);

	// "https://api-ssl.bitly.com/v3/shorten?access_token=68c5b0fd0c41d25ab07ee7d7945242daf0fd5091&longUrl=https://script.google.com/macros/s/AKfycbyhMMEzWxNMmxZzyn8f9ot2YdROT9UThZeba_an3YDun2F0hot2/exec?value=const%20takesThreeArgs%20%3D%20function(a%2C%20b%2C%20c)%20%7B%0A%20%20return%20%5Ba%2C%20b%2C%20c%5D%3B%0A%7D%3B%0AtakesThreeArgs.length%3B%20%2F%2F%3D%3E%203%0AtakesThreeArgs(1%2C%202%2C%203)%3B%20%2F%2F%3D%3E%20%5B1%2C%202%2C%203%5D%0A"
	// fetch('http://example.com/movies.json')
	fetch(`https://api-ssl.bitly.com/v3/shorten?access_token=68c5b0fd0c41d25ab07ee7d7945242daf0fd5091&longUrl=${encodeURIComponent(URL)}`)
	.then((response) => {
		return response.json();
	})
	.then((data) => {
		console.log(data);
		console.log(data.data.url);

		// new QRCode(document.getElementById("qrcode"), {
		// 	// text: `https://api-ssl.bitly.com/v3/shorten?access_token=68c5b0fd0c41d25ab07ee7d7945242daf0fd5091longUrl=${URL}`,
		// 	text: data.data.url,
		// 	width: 200,
		// 	height: 200,
		// 	colorDark : "#000000",
		// 	colorLight : "#ffffff",
		// 	correctLevel : QRCode.CorrectLevel.H
		// });

		new QRCode(document.querySelector("#qrcode"), data.data.url);
		// new QRCode(document.querySelector("#qrcode"), URL);
	});


}
//// google apps script side source codeã€€////
// 	function doGet(e) {
//   const HTML = `<textarea name="textField" id="textField" cols="50" rows="10" required="required" maxlength="1900" autofocus="autofocus" style="font-size: 16px;transform: scale(0.9);">${e.parameter.value}</textarea>`
//   return HtmlService.createHtmlOutput(HTML);
// }
</script>
</body>
</html>