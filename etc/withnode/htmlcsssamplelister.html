<!DOCTYPE html>
<head>
<meta charset="UTF-8" />
<title>html css sample lister</title>
<script src="ramda.min.js"></script>
<script src="clipboard.js"></script>
<script src="dexie.js"></script>
</head>
<body>
<!-- <button id="showArrayList" onclick="showArrayList();">showArrayList</button> -->
<button id="newData" onclick="newData();">newData</button>
<button id="test" onclick="test();">test</button>
<!-- <button id="save" onclick="save();">save</button> -->
<!-- <button id="load" onclick="load();">load</button> -->
<button id="DELETE" onclick="DELETE();location.reload();">DELETE</button>
<div>
	<textarea name="tag" id="tag" cols="20" rows="10" required="required" oninput="exe()"></textarea>
	<textarea name="css" id="css" cols="20" rows="10" required="required" oninput="exe()"></textarea>
</div>
<script>
new ClipboardJS('.btn');

const beforeExe = () =>{
	document.querySelector("html > body > style") ? document.querySelector("html > body > style").parentNode.removeChild( document.querySelector("html > body > style") ) : false;
	document.querySelector("html > body > div#box") ? document.querySelector("html > body > div#box").parentNode.removeChild( document.querySelector("html > body > div#box") ) : false;
}
const tagInsert = () => document.querySelector("#tag").value;
const style = () => `<style type="text/css">${document.querySelector("#css").value}</style>`;
const exe = () =>{
	beforeExe()
	document.querySelector(`body`).insertAdjacentHTML(`beforeEnd`, `<div id="box"></div>` );
	document.querySelector(`#box`).insertAdjacentHTML(`beforeend`, tagInsert() );
	document.querySelector(`body`).insertAdjacentHTML(`beforeEnd`, style() );
	save();
}
const test = () =>{
	document.querySelector("#tag").value = `<p><a>hello world</a></p>`;
	document.querySelector("#css").value = `p {font-size: 50px;}`;
	exe();
}

let dataArray=[];
const showArrayList = () => {
	document.querySelectorAll(".list").forEach(E=>{E.parentNode.removeChild(E)});
	document.querySelector(`body`).insertAdjacentHTML(`afterbegin`, dataArray.map((V,KEY)=>{return `<div class="list" data-key="${KEY}" onclick="dataInsertToTextarea(event);">${KEY}</div>`}).join("") );
}
const newData = () =>{
	dataArray.push( [document.querySelector("#tag").value,document.querySelector("#css").value] );
	showArrayList();
	save();
}
const dataInsertToTextarea = (key) =>{
	[document.querySelector("#tag").value,document.querySelector("#css").value] = 
	[
		dataArray[Number(event.target.dataset.key)][0],
		dataArray[Number(event.target.dataset.key)][1]
	]
	exe();
}



const titleTagStr = document.querySelector("title").textContent.split(" ").join("");
let DB;
const CREATE = () =>{DB = new Dexie(titleTagStr);DB.version(1).stores({table0:"id,data"});};
const READ = () =>DB.table0.get(0).then((RECORD)=>{dataArray=RECORD.data;showArrayList()});
const load = () => {READ();} // alias from READ()
const UPDATE = () =>DB.table0.put({id:0,data:document.querySelector("#text0").value});
const DELETE = () =>Dexie.delete(titleTagStr);


const save = () => {
	DB.table0.put({id:0,data:dataArray})
};

CREATE();
load();

// document.querySelector("#test").onclick();
</script>
</body>
</html>