<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ala sql with faker js</title>
    <script src="alasql.js"></script>
    <script src="faker.js"></script>
    <script src="ramda.js"></script>
    <style>
        *{
            margin: 0;
            padding: 0;
        }
.outer{
    height: 100vw;
            display: grid;
            grid-template-columns: 0.3fr 1.7fr;
            grid-template-rows: 0.3fr 1.7fr;
            grid-template-areas:
"side main"
"side main";
/* background-color: red; */
}
div.main{
    grid-area: main;
    width: 100%;
    /* background-color: red; */
}
div.side{
    grid-area: side;
    width: 100%;
    /* background-color: blue; */
}
/* https://codepen.io/kallmanation/pen/abdmJNz */
details {
  /* padding: 0px; */
  border: solid black 1px;
}
details > * {
  width: 100%;
  /* padding: 10px; */
  margin: 0px;
  /* background-color: blue; */
}
.clicked{
    opacity: 0.5;
    color: blueviolet;
    background-color: blue;
}
textarea{
    /* width: 100vw; */
    width: 100%;
}
    </style>
</head>
<body class="outer">
<div class="main">
    SELECT
    <input type="text" name="" class="column0" value="2">
    FROM
    <input type="text" name="" class="table1" value="LIST">

    <input type="number" class="nTimes" value="10">

    <textarea cols="30" rows="10" class="textarea1"></textarea>
    <textarea cols="30" rows="10" class="textarea2"></textarea>
    <textarea cols="30" rows="10" class="textarea3"></textarea>

    <textarea name="" class="query1" id="" cols="30" rows="10" oninput="exe();"></textarea>
    <textarea name="" class="query2" id="" cols="30" rows="10" oninput="exe();"></textarea>
    <textarea name="" class="res1" id="" cols="30" rows="10" oninput="exe();"></textarea>



    <!-- https://codepen.io/kallmanation/pen/abdmJNz -->
    <!-- <details close>
        <summary>CSS-only Accordion</summary>
        <p>Using the &lt;details&gt; element</p>
        <p>And no unnecessary DOM</p>
    </details> -->

    <input type="text" name="" id="" class="oneline">

    <button onclick="test()">test data</button>
    <button onclick="test2()">test2 data</button>
</div>
<div class="side">
    <div class="fakerMenu"></div>
    <script src="fakerMenu.js"></script>
    <script defer>
    document.querySelector(".fakerMenu").insertAdjacentHTML("afterbegin", fakerMenuStr);
    function chooseLang() { faker.locale = document.querySelector(".lang").value };
    </script>
</div>

<script>


// values
// var foo0 = [1,2,3];
// const foo1 = [1,2,3];
// let foo2 = [1,2,3];
var LIST = [];
var allClickedAry;
var headerAry;
let tmpList;




function collectChoosedMethods() {
    return Array.from(document.querySelectorAll(".clicked")).map(V => {
        const category = V.parentElement.parentElement.querySelector("summary").innerText;
        const method = V.innerText;
        return faker[category][method];
    })
}

function makeList() {
    LIST = [];
    const times = Number(document.querySelector("input.nTimes").value);
    [...Array(times).keys()].forEach(NOUSE => {
        LIST.push(collectChoosedMethods().map(V => { return V() }));
    })
    return LIST;
}

function clicked(event) {
    // console.log(event.taget.classList.value);
    event.target.classList.value.includes("clicked") ? event.target.classList.remove("clicked") : event.target.classList.add("clicked");
    makeList();
    insertListToTextarea1();
    insertListToTextarea2();
}

function init() {
    document.querySelectorAll("li").forEach(V => {
        V.addEventListener("click", showInputTagOneline, false);
        V.addEventListener("click", clicked, false);
    })    
}

init();

//////////////////// WIP
// query
function query0() {
    console.log(document.querySelector(".column0").value);
    console.log(document.querySelector(".table1").value);
    const foo = Number(document.querySelector(".column0").value);
    const bar = document.querySelector(".table1").value;
    const baz = R.pluck(foo, window[bar]);
    console.log(baz);
    document.querySelector(".textarea3").value = baz;
}
//////////////////// WIP


// to display
function showInputTagOneline(event) {
    const category = event.target.parentElement.parentElement.querySelector("summary").innerText;
    const method = event.target.innerText;
    // console.log(faker[category][method]()); // this is same faker.name.firstName();
    document.querySelector("input.oneline").value = faker[category][method]();
}
function insertListToTextarea1() {
    allClickedAry = Array.from(document.querySelectorAll(".clicked")).map(V => {
        return `${V.parentElement.parentElement.querySelector("summary").innerText}, ${V.innerText}`
    });
    document.querySelector("textarea.textarea1").value = allClickedAry.join("\n");
    headerAry = allClickedAry.map(V=>{return V.split(",")[0] + V.split(",")[1].replace(" ", "_") });
}
function insertListToTextarea2() {
    const resultForTextarea = LIST.map(V => { return V + "\n" }).join("");
    document.querySelector("textarea.textarea2").value = resultForTextarea;
}

// test function
function testAnyClick(any = "firstName") {
    Array.from(document.querySelectorAll("li")).filter(V => { return V.innerText === any })[0].click();
}
function test() {
    document.querySelector(".lang").value = "ja";
    chooseLang();
    Array.from(document.querySelectorAll("li")).filter(V => { return V.innerText === "firstName" })[0].click();
}
function test2() {
    document.querySelector(".lang").value = "ja";
    chooseLang();
    testAnyClick("zipCode");
    testAnyClick("firstName");
    testAnyClick("lastName");
    testAnyClick("past");
    query0();
}


let insertValues;
function test1(){    
    insertValues = LIST.map(V=>{return [V[0], V[2], V[3]]}).map(V=>{return `('${V[0]}', '${V[1]}', '${V[2]}'),`}).join("");
    insertValues = insertValues.slice(0, insertValues.length-1);

    // document.querySelector(".query1").value = `CREATE TABLE cities (city string, pop number);INSERT INTO cities VALUES ('Paris',2249975),('Berlin',3517424),('Madrid',3041579)`;

// const insertValues = `('Paris',2249975),('Berlin',3517424),('Madrid',3041579)`;

document.querySelector(".query1").value =
`CREATE TABLE LIST0 (foo string, bar string, baz string); INSERT INTO LIST0 VALUES ${insertValues}`;
// `CREATE TABLE cities (city string, pop number);INSERT INTO cities VALUES ('Paris',2249975),('Berlin',3517424),('Madrid',3041579)`;
    document.querySelector(".query2").value = `SELECT * FROM LIST0`;

    // document.querySelector(".query2").value = `SELECT * FROM cities WHERE pop < 3500000 ORDER BY pop DESC`;

    alasql(document.querySelector(".query1").value);
    var res1 = alasql( document.querySelector(".query2").value );
    var res1_2 = res1.map(V=>{
        let ary = [V.foo, V.bar, V.baz];
        return ary;
    })
    document.querySelector(".res1").value = res1_2;
}

function exe(){
    try {
        alasql(document.querySelector(".query1").value);
    } catch (error) {
        console.error(error);
    }
    var res1 = alasql( document.querySelector(".query2").value );
    var res1_2 = res1.map(V=>{ return [V.foo, V.bar, V.baz] })
    document.querySelector(".res1").value = res1_2;
}
test2();
test1();
exe();

</script>
</body>

</html>