<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>testalasql</title>
    <script src="alasql.js"></script>
    <script src="localforage.js"></script>
    <style>

.result{
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    grid-template-rows: repeat(10, 1fr);
}
.zero {
    grid-column: 1 / 2;
    grid-row: 1 / 10;
}
.one {
    grid-column: 3 / 4;
    grid-row: 1 / 10;
}
textarea{
    width: 200%;
}
button{
    width: 100px;
    height: 50px;
}
    </style>
</head>
<body class="result">
<div class="zero">
<button class="button-2" onclick="settest();exe()">settestandexe</button>

<button class="button-0" onclick="settest();" value="settest">settest</button>

<textarea name="textarea-0" cols="50" rows="10" class="textarea-0" onclick=""></textarea>
<textarea name="textarea-1" cols="50" rows="10" class="textarea-1" onclick=""></textarea>
<textarea name="textarea-2" cols="50" rows="10" class="textarea-2" onclick=""></textarea>
<button class="button-1" onclick="exe();" value="exe">exe</button>

<button onclick="testSave();">testSave</button>
<button onclick="testLoad();">testLoad</button>

<button
    onclick="localforage.clear().then(function () {console.log('Database is now empty.')}).catch(function (err) {console.log(err)});">clear
    localForage</button>
    <span class="err"></span>
<!-- <textarea name="textarea-3" cols="50" rows="10" class="textarea-3" onclick=""></textarea> -->
</div>
<div class="one">
<table class="app"></table>
</div>

<script>
    localforage.config({
        // bytes
        size: 1000
        // => limit size 1kb
    });
</script>

<script>
// CREATE TABLE category (
// category_id TINYINT UNSIGNED NOT NULL AUTO_INCREMENT,
// name VARCHAR(25) NOT NULL,
// last_update TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
// PRIMARY KEY (category_id)
// );

// CREATE TABLE film_category (
// film_id SMALLINT UNSIGNED NOT NULL,
// category_id TINYINT UNSIGNED NOT NULL,
// last_update TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
// PRIMARY KEY (film_id, category_id),
// FOREIGN KEY (film_id) REFERENCES film (film_id), --ON DELETE RESTRICT ON UPDATE CASCADE,
// FOREIGN KEY (category_id) REFERENCES category (category_id) --ON DELETE RESTRICT ON UPDATE CASCADE
// );

// CREATE TABLE language (
// language_id TINYINT UNSIGNED NOT NULL AUTO_INCREMENT,
// name CHAR(20) NOT NULL,
// last_update TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
// PRIMARY KEY (language_id)
// );

// CREATE TABLE actor (
// actor_id SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT,
// first_name VARCHAR(45) NOT NULL,
// last_name VARCHAR(45) NOT NULL,
// last_update TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
// PRIMARY KEY (actor_id)
// );

// CREATE TABLE film_actor (
// actor_id SMALLINT UNSIGNED NOT NULL,
// film_id SMALLINT UNSIGNED NOT NULL,
// last_update TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
// PRIMARY KEY (actor_id,film_id),
// FOREIGN KEY (actor_id) REFERENCES actor (actor_id), --ON DELETE RESTRICT ON UPDATE CASCADE,
// FOREIGN KEY (film_id) REFERENCES film (film_id) --ON DELETE RESTRICT ON UPDATE CASCADE
// );

// CREATE TABLE film (
// film_id SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT,
// title VARCHAR(128) NOT NULL,
// description TEXT DEFAULT NULL,
// release_year YEAR DEFAULT NULL,
// language_id TINYINT UNSIGNED NOT NULL,
// original_language_id TINYINT UNSIGNED DEFAULT NULL,
// rental_duration TINYINT UNSIGNED NOT NULL DEFAULT 3,
// rental_rate DECIMAL(4,2) NOT NULL DEFAULT 4.99,
// length SMALLINT UNSIGNED DEFAULT NULL,
// replacement_cost DECIMAL(5,2) NOT NULL DEFAULT 19.99,
// rating ENUM('G','PG','PG-13','R','NC-17') DEFAULT 'G',
// -- special_features SET('Trailers','Commentaries','Deleted Scenes','Behind the Scenes') DEFAULT NULL,
// last_update TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
// PRIMARY KEY (film_id),
// FOREIGN KEY (language_id) REFERENCES language (language_id), --ON DELETE RESTRICT ON UPDATE CASCADE,
// FOREIGN KEY (original_language_id) REFERENCES language (language_id) --ON DELETE RESTRICT ON UPDATE CASCADE
// );


function setDataToTextarea() {
document.querySelector(".textarea-0").value =
`
CREATE TABLE IF NOT EXISTS bar (
bar_id TINYINT NOT NULL,
bar_txt VARCHAR(50) NOT NULL,
PRIMARY KEY (bar_id)
);
CREATE TABLE IF NOT EXISTS foo (
foo_id TINYINT NOT NULL AUTO_INCREMENT,
bar_id TINYINT NOT NULL,
foo_txt VARCHAR(50) not null,
PRIMARY KEY (foo_id),
FOREIGN KEY (foo_id) REFERENCES bar (bar_id)
);
`;
document.querySelector(".textarea-1").value =
`
insert into bar (bar_id, bar_txt) values (1, "bar1");
insert into bar (bar_id, bar_txt) values (2, "bar2");
insert into bar (bar_id, bar_txt) values (3, "bar3");
insert into bar (bar_id, bar_txt) values (4, "bar4");
insert into bar (bar_id, bar_txt) values (5, "bar5");

insert into foo (bar_id, foo_txt) values (1, 'baz');
insert into foo (bar_id, foo_txt) values (2, 'bazbaz');
insert into foo (bar_id, foo_txt) values (3, 'bazbazbaz');
`;
document.querySelector(".textarea-2").value =
`
select * from foo join bar on foo.bar_id = bar.bar_id;
`;
}
// document.querySelector(".textarea-3").value =`select * from foo join bar on foo.bar_id = bar.bar_id;`;

function setTextareaToAlasqlAndReturnData() {
    alasql(document.querySelector(".textarea-0").value);
    alasql(document.querySelector(".textarea-1").value);
    return alasql(document.querySelector(".textarea-2").value);
    // return alasql(document.querySelector(".textarea-3").value);
}

function makeTrTdHeader(data) {
    return data.map(V =>
        Object.entries(V)).map(VAL =>
            `<tr>${VAL.map(VALUE =>
                `<td>${VALUE[0]}</td>`)
                .join("")}
                    </tr>`)
    [0];
}
function makeTrTd(data) {
    return data.map(V =>
        Object.entries(V)).map(VAL =>
            `<tr>${VAL.map(VALUE =>
                `<td>${VALUE[1]}</td>`)
                .join("")}
                    </tr>`)
        .join("");
}
function makeTableHtml(data) {
    return makeTrTdHeader(data) + makeTrTd(data);
}
function settest() {
    setDataToTextarea();
}
function exe() {
    document.querySelector('.app').innerHTML = makeTableHtml(setTextareaToAlasqlAndReturnData());
}


async function testSave() {
    const data = Array.from(document.querySelectorAll(".textarea-0, .textarea-1, .textarea-2")).map(V=>V.value);
    await localforage.setItem("textAreaData", JSON.stringify(data))
        .then(res =>
        document.querySelector(".err").value = "success"
        ).catch(err =>
        document.querySelector(".err").value = err
        );
}
let tmp;
async function testLoad() {
    try {
        const preData = await localforage.getItem("textAreaData");
        const data = JSON.parse(preData);
        tmp = await data;
        document.querySelectorAll(".textarea-0, .textarea-1, .textarea-2").forEach((V,IDX)=> V.value = data[IDX] );
    } catch (err) {
        document.querySelector(".err").value = err;
    }
}

</script>
</body>
</html>