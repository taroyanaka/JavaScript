<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tagList</title>
    <style>
        :root{
            --li-display: block;
        }
        li{
            list-style: none;
            display: block;
        }
        li.noShow{
            /* --li-display: none; */
            display: none;
        }
        /* .list{
            display: block;
        }
        .noList{
            display: none;
        } */
        span{
            margin: 1rem;
        }
        .done{
            width: 1.4rem;
            height: 1.4rem;
        }
    </style>
</head>
<body>

<button onclick="exe2()">exe2</button>
<input type="text" name="listName" class="listName"><span onclick="insertNewList()">+</span>
<input type="text" name="text" class="text">
<!-- <input type="checkbox" name="done" class="done"> -->
<!-- <h1 class="foo"></h1> -->
<ul class="ul"></ul>

<script>
document.querySelector('.ul').innerHTML = 
    [
        `<li class="list"><input type="checkbox" name="done" class="done"><select name="rate" class="rate" onchange="setRateOptionHTML()"></select><span class="val">foo</span><span class="tag-parent"></span><span onclick="addTag(event)" class="tag-add">+</span></li>`,
        `<li class="list"><input type="checkbox" name="done" class="done"><select name="rate" class="rate" onchange="setRateOptionHTML()"></select><span class="val">bar</span><span class="tag-parent"></span><span onclick="addTag(event)" class="tag-add">+</span></li>`,
        `<li class="list"><input type="checkbox" name="done" class="done"><select name="rate" class="rate" onchange="setRateOptionHTML()"></select><span class="val">baz</span><span class="tag-parent"></span><span onclick="addTag(event)" class="tag-add">+</span></li>`,
    ]
    .join(' ');

// https://stackoverflow.com/a/60989268
function rankings(arr){
    // add whatever parameters you deem necessary....good luck! 
    var sorted = arr.slice().sort(function(a,b){return b-a})
    var ranks = arr.slice().map(function(v){ return sorted.indexOf(v)});
    return ranks;
}

function range(from,to){return[...Array(to-from)].reduce((A,V,IDX)=>{A.push(from+IDX);return A},A=[])};
const getMaxRateNum = () => Array.from(document.querySelectorAll(`.rate`)).map(V=>Number(V.value)).sort().reverse()[0];
const setMaxRateNum = () => getMaxRateNum() === 0 ? 2 : getMaxRateNum() + 2;
const rateOptionHTML = () => range(0, setMaxRateNum()).map(rateNum=>`<option value="${rateNum}">${rateNum}</option>`).join("");
const setRateOptionHTML = () => {
    document.querySelectorAll(`.rate`).forEach(V=>{
        const tmp = V.value;
        V.innerHTML = rateOptionHTML()
        V.value = tmp;
    })
};

setRateOptionHTML();

// const getRateNum = (EVENT) => console.log(EVENT.target.value);




const newListName = () => document.querySelector(`.listName`).value || document.querySelectorAll(`.list`).length;
const makeListHTML = () => `<li class="list"><span class="val">${newListName()}</span><span class="tag-parent"></span><span onclick="addTag(event)" class="tag-add">+</span></li>`;
const insertNewList = () => document.querySelector(`.ul`).innerHTML += makeListHTML();


// const addTag = (EVENT) => console.log(EVENT.target.previousElementSibling.outerHTML);

const addTag = (EVENT) => EVENT.target.previousElementSibling.innerHTML += `<span class="tag-child">${document.querySelector(`.text`).value}</span>`;

// const addTag = (e) => console.log(e.target);
// EVENT.target.previousElementSibling.innerHTML += `<span class="tag-child">${document.querySelector(`.text`).value}</span>`;
const tagOnly = () => document.querySelector(`.tag-add`).previousElementSibling.innerHTML += `<span class="tag-child">${document.querySelector(`.text`).value}</span>`;

function mergeAll(list){return Object.assign.apply({},[].concat(list))};
const exe = () => {
    return ["tag_0",
"tag_1",
"tag_3"]
.reduce((acc, cur) => {
    acc.push(Array.from(document.querySelectorAll(".tag-child")).filter(V=>V.textContent !== cur).map(V=>V.parentElement.parentElement));
    return acc;
}, []);
};

const tagFilter = () => mergeAll(exe());

const exe2 = () => {
    Array.from(document.querySelectorAll(".list")).forEach(V=>V.classList.add("noShow"));
    tagFilter().forEach(V=>V.classList.remove("noShow"));
};

// const tagNoFilter = () => Array.from(document.querySelectorAll(".tag-child"));

const init = () => {
    document.querySelector(`.listName`).value = "ThisIsListName";
    document.querySelector(`.text`).value = "tag_0";
};
init();
</script>
</body>
</html>