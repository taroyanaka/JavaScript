<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>how_to_validate</title>
    <!-- <script src="//cdnjs.cloudflare.com/ajax/libs/ramda/0.28.0/ramda.min.js"></script> -->
    <script src="./ramda.@0.28.0.js"></script>
    <script src="https://unpkg.com/validator@latest/validator.min.js"></script>
</head>
<body>
<input type="text" class="vali_target" oninput="exe()">
<div></div>
<span class="vali_value"></span>
<div></div>
<span class="vali_err"></span>
<span class="error_list"></span>


<script>
const get_vali_target = () => document.querySelector(`.vali_target`).value;
const validate_table = [
    [get_vali_target, "isLength", {min: 2, max: 3},  "error: isLength: {min: 2, max: 3}", (()=>{throw "error: isLength: {min: 2, max: 3}"})],
    [get_vali_target, "isLength", {min: 5, max: 7},  "error: isLength: {min: 5, max: 7}", (()=>{throw "error: isLength: {min: 5, max: 7}"})],
]


const validate = (PARAM_GET_STR_FN, PARAM_TYPE, PARAM_OPTION, ERROR_MSG) => {
    const vali_fn = (TYPE, str, OPTION) => validator[TYPE](str, OPTION);
    const str_vali = (STR) => vali_fn(PARAM_TYPE, STR, PARAM_OPTION) ? STR : ERROR_MSG;
    const str_vali3 = (STR) => vali_fn(PARAM_TYPE, STR, PARAM_OPTION) ? '' : ERROR_MSG;
    const RESULT = () =>  [PARAM_GET_STR_FN(), str_vali3(PARAM_GET_STR_FN())];
    return RESULT();
};

let error_list = [];
const insert_data = (SELECTOR, DATA) => document.querySelector(SELECTOR).textContent = DATA;
const insert_data2 = (SELECTOR, DATA) => document.querySelector(SELECTOR).textContent += DATA;

const set_data2 = (ARY) => {
    console.table(ARY[1]);
    insert_data(`.vali_value`, ARY[0]);
    insert_data2(`.vali_err`, ARY[1]);
};

const validate_table_exe = () => validate_table.map(V=> validate(...V));
const exe = () =>{
    document.querySelector(`.vali_err`).textContent = "";
    validate_table_exe().forEach(V=> set_data2(V) );
}

console.table(exe());

const f1 = () =>{try{return "no error";throw "ERROR";}catch(error){return error} };
// f1();

// R.tryCatch(() => { throw 'this is not a valid value'}, (err, value)=>({error : err,  value }))('bar')
// => {'error': 'this is not a valid value', 'value': 'bar'}

const f2 = (fn, STR) => R.tryCatch(fn(STR), (err, value)=>({error : err,  value }) );
const f2_1 = () => R.tryCatch( ()=>{throw "error: isLength: {min: 5, max: 7}"} , (err, value)=>({error : err,  value }) )("BAR");



const makeValidator = (str, TYPE, OPTION) => validator[TYPE](str, OPTION);
const f2_2 = (STR, TYPE, OPTION, ERROR_MSG) =>{
    return R.tryCatch( 
        makeValidator(STR, TYPE, OPTION) ? ()=>{throw null} : ERROR_MSG,
        (ERROR, FN)=>( FN(ERROR, STR) ),
    )
};
const f3 = (ERROR, STR) => ERROR ? console.log("f3 error and " + ERROR) : console.log("f3 success and " + STR);
f2_2("foo", "isLength", {min: 1, max: 3}, ()=>{throw "error: isLength: {min: 1, max: 3}"})(f3);
f2_2("fooooooooooooooo", "isLength", {min: 1, max: 3}, ()=>{throw "error: isLength: {min: 1, max: 3}"})(f3);

</script>
</body>
</html>