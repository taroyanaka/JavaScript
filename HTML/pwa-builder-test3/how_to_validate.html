<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>how_to_validate</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<!-- <script src="https://unpkg.com/@supabase/supabase-js"></script> -->

<!-- <script type="module">
const { createClient } = supabase

const _supabase = createClient(
    "https://djhupqmcmcbjzshlclvh.supabase.co", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYyMDEwNTk1MiwiZXhwIjoxOTM1NjgxOTUyfQ.dWSNd32JmaceJP35Hgwn2Ib9iKviNiAYu4Fvw2eOSjs"
);


console.log('Supabase Instance: ', _supabase)
// console.log('Supabase Instance: ', supabase)
async function signInWithGoogle() {
  const { user, session, error } = await _supabase.auth.signIn({
    provider: 'google',
  })
}
</script> -->

<style>
.blog {
    /* visibility: hidden; */
    display: none;
    display: block;
}
</style>
    <!-- <script src="//cdnjs.cloudflare.com/ajax/libs/ramda/0.28.0/ramda.min.js"></script> -->
    <script src="./ramda.@0.28.0.js"></script>
    <script src="https://unpkg.com/validator@latest/validator.min.js"></script>
</head>
<body>
<input type="text" class="vali_target" oninput="exe()" minlength="1" maxlength="3" required>
<div></div>
<span class="vali_value"></span>
<div></div>
<span class="vali_err"></span>
<span class="error_list"></span>


<script>
const get_vali_target = () => document.querySelector(`.vali_target`).value;
const validate_table = [
    [get_vali_target, "isLength", {min: 2, max: 3},  "error: isLength: {min: 2, max: 3}", (()=>{throw "error: isLength: {min: 2, max: 3}"})],
    [get_vali_target, "isLength", {min: 5, max: 7},  "error: isLength: {min: 5, max: 7}", (()=>{throw "error: isLength: {min: 5, max: 7}"})],
]


const validate = (PARAM_GET_STR_FN, PARAM_TYPE, PARAM_OPTION, ERROR_MSG) => {
    const vali_fn = (TYPE, str, OPTION) => validator[TYPE](str, OPTION);
    const str_vali = (STR) => vali_fn(PARAM_TYPE, STR, PARAM_OPTION) ? STR : ERROR_MSG;
    const str_vali3 = (STR) => vali_fn(PARAM_TYPE, STR, PARAM_OPTION) ? '' : ERROR_MSG;
    const RESULT = () =>  [PARAM_GET_STR_FN(), str_vali3(PARAM_GET_STR_FN())];
    return RESULT();
};

let error_list = [];
const insert_data = (SELECTOR, DATA) => document.querySelector(SELECTOR).textContent = DATA;
const insert_data2 = (SELECTOR, DATA) => document.querySelector(SELECTOR).textContent += DATA;

const set_data2 = (ARY) => {
    console.table(ARY[1]);
    insert_data(`.vali_value`, ARY[0]);
    insert_data2(`.vali_err`, ARY[1]);
};

const validate_table_exe = () => validate_table.map(V=> validate(...V));
const exe = () =>{
    document.querySelector(`.vali_err`).textContent = "";
    validate_table_exe().forEach(V=> set_data2(V) );
}

console.table(exe());

const f1 = () =>{try{return "no error";throw "ERROR";}catch(error){return error} };
// f1();

// R.tryCatch(() => { throw 'this is not a valid value'}, (err, value)=>({error : err,  value }))('bar')
// => {'error': 'this is not a valid value', 'value': 'bar'}

const f2 = (fn, STR) => R.tryCatch(fn(STR), (err, value)=>({error : err,  value }) );
const f2_1 = () => R.tryCatch( ()=>{throw "error: isLength: {min: 5, max: 7}"} , (err, value)=>({error : err,  value }) )("BAR");



const makeValidator = (STRING, TYPE, OPTION) => validator[TYPE](STRING, OPTION);
const f2_2 = (STRING, TYPE, OPTION, ERROR_MESSAGE) =>{
    return R.tryCatch( 
        makeValidator(STRING, TYPE, OPTION) ? ()=>{throw null} : ()=>{throw ERROR_MESSAGE},
        (ERROR, FUNCTION)=>( FUNCTION(ERROR, STRING) )
    )
};
const f3 = (ERROR, STR) => ERROR ? console.log("f3 error and " + ERROR) : console.log("f3 success and " + STR);

const exe_query_or_not = (query_function) => (ERROR, STR) => ERROR ? {error: ERROR} : query_function(STR);




// validate_and_exe_or_no_exe(req.query.info, "isLength", {min: 1, max: 30}, {"message": "error: isLength: {min: 1, max: 30}"})(exe_query_or_not((STRINGS_ARRAY)=>db_query_insert_and_select(STRINGS_ARRAY)))

// f2_2("foo", "isLength", {min: 1, max: 3}, "error: isLength: {min: 1, max: 3}")(f3);
// f2_2("fooooooooooooooo", "isLength", {min: 1, max: 3}, "error: isLength: {min: 1, max: 3}")(f3);

const query_fn = (STR) => {
    // db.prepare('INSERT INTO lorem (info) values(?)').run(STR);
    console.log(STR);
    return STR;
}
const query_ready_exe_query_or_not = exe_query_or_not(query_fn);
f2_2("foo", "isLength", {min: 1, max: 3}, "error: isLength: {min: 1, max: 3}")(query_ready_exe_query_or_not);
f2_2("foo", "isLength", {min: 1, max: 3}, "error: isLength: {min: 1, max: 3}")(exe_query_or_not((STR)=>console.log(STR+"FOOBARBUZ")));

const res1 = f2_2("foo", "isLength", {min: 1, max: 3}, "error: isLength: {min: 1, max: 3}")(exe_query_or_not((STR)=>{console.log(STR+"FOOBARBUZ");return {res: STR+"FOOBARBUZ"}}));
const res2 = f2_2("fooooooooooooooooooo", "isLength", {min: 1, max: 3}, "error: isLength: {min: 1, max: 3}")(exe_query_or_not((STR)=>{console.log(STR+"FOOBARBUZ");return {res: STR+"FOOBARBUZ"}}));
console.table("res is:", res1, " and ", res2);

// f2_2("foo", "isLength", {min: 1, max: 3}, ()=>{throw "error: isLength: {min: 1, max: 3}"})(f3);
// f2_2("fooooooooooooooo", "isLength", {min: 1, max: 3}, ()=>{throw "error: isLength: {min: 1, max: 3}"})(f3);

const f10 = () => true;
const f11 = () => false;
const f12 = () => true;
const f13 = () => false;

const is_truthy = (x) => x;
const just_exe_fn_in_array = (fn_in_array) => fn_in_array.map(fn=>fn());

console.log(just_exe_fn_in_array([f10, f11, f12, f13]).every(is_truthy));
console.log(just_exe_fn_in_array([f10, f12]).every(is_truthy));
console.log(just_exe_fn_in_array([f11, f13]).every(is_truthy));

const f14 = () => "foo";
const f15 = () => "";
const f16 = () => "bar";
const f17 = () => null;

console.log(just_exe_fn_in_array([f14, f15, f16, f17]).every(is_truthy));
console.log(just_exe_fn_in_array([f14, f16]).every(is_truthy));
console.log(just_exe_fn_in_array([f14, f15]).every(is_truthy));
console.log(just_exe_fn_in_array([f15, f17]).every(is_truthy));
console.log(just_exe_fn_in_array([f17]).every(is_truthy));


const f18 = () => document.querySelector(`.vali_target`).value = "fooooooooooooo";
f18();


// req.query.info, "isLength", {min: 1, max: 30}, {"message": "error: isLength: {min: 1, max: 30}"}
const validate_and_exe_or_no_exe = (STRING, TYPE, OPTION, ERROR_MESSAGE) =>{
    const VALIDATE = makeValidator(STRING, TYPE, OPTION);
    // return R.tryCatch( 
        // makeValidator(STRING, TYPE, OPTION) ? ()=>{throw null} : ()=>{throw ERROR_MESSAGE},
        // (ERROR, FUNCTION)=>( FUNCTION(ERROR, STRING) )
    // )
};
const validate_strings_array_and_exe_or_no_exe = (STRINGS_ARRAY, TYPE, OPTION, ERROR_MESSAGE) =>{
    return R.tryCatch( 
        STRINGS_ARRAY.map(STRING=>makeValidator(STRING, TYPE, OPTION)).every(x=>x === true) ? ()=>{throw null} : ()=>{throw ERROR_MESSAGE},
        (ERROR, FUNCTION)=>( FUNCTION(ERROR, STRINGS_ARRAY) )
    )
};

const data_and_rule_list = [
    ["FOO", "isLength", {min: 1, max: 2}, "error: isLength: {min: 1, max: 2}"],
    ["BAR", "isLength", {min: 4, max: 6}, "error: isLength: {min: 4, max: 6}"],
    ["BUZ", "isLength", {min: 8, max: 10}, "error: isLength: {min: 8, max: 10}"],
]
const pre_separate_data_or_error_message = (data_and_rule_list) => data_and_rule_list.map(V=>makeValidator(V[0], V[1], V[2]) ? ["data", V[0]] : ["error", V[3]]);

// const exe_query_or_not = (query_function) => (ERROR, STR) => ERROR ? ERROR : query_function(STR);
// const exe_query_or_not_with_id = (query_function) => (ERROR, STR, ID) => ERROR ? ERROR : query_function(STR, ID);

const is_all_no_error = (data_and_rule_list) => pre_separate_data_or_error_message(data_and_rule_list).every(x=>x[0]==="data");
const only_data = (data_and_rule_list) => data_and_rule_list.map(V=>V[0]);
const only_error_message = (data_and_rule_list) => pre_separate_data_or_error_message(data_and_rule_list).filter(x=>x[0]==="error").map(V=>V[1]);
const separate_data_or_error_message = (data_and_rule_list) => is_all_no_error(data_and_rule_list) ? only_data(data_and_rule_list) : only_error_message(data_and_rule_list);

</script>
</body>
</html