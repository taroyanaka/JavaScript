<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>image-to-name</title>
    <style>
        .res{
            font-size: 3rem;
        }
        img{
            width: 4.5rem;
            height: 4rem;
        }
        /* input.file, */
        input[value="❎"], input[value="⏬"], input[value="🔃"], input[value="❌"]{
            width: 4.5rem;
            height: 4rem;
            font-size: 2rem;
        }
        input[type="file"] {
            display: none;
        }
        .custom-file-upload {
            border: 1px solid #ccc;
            display: inline-block;
            padding: 1rem;
            font-size: 2rem;
        }
    </style>
</head>

<body>
<!-- <img src="https://pngimg.com/uploads/cat/cat_PNG50538.png" alt=""> -->
<!-- https://pngimg.com/uploads/dog/dog_PNG159.png -->

<!-- https://stackoverflow.com/a/25825731 -->
<label for="file" class="custom-file-upload" value="📁" onchange="nameInsert()">
    <input type="file" id="file" multiple>
    📁
</label>


<!-- <input type="text" name="answer" class="answer" placeholder="image name"> -->
<textarea  name="answer" class="answer" placeholder="image name" cols="30" rows="10"></textarea>
<input type="button" value="⏬" onclick="addQA()">

<input type="button" value="🔃" onclick="removeOrUnremoveAndCheckAllQA(event)" data-removed="">
<input type="button" value="❌" onclick="removeAllQA()">

<div class="parent_qa">
<div class="qa qa_0">
    <img src="cat.png" alt="cat" data-answer="cat">
    <input type="text" name="text" class="text" oninput="fn(0);" value="cat">
    <span class="res"></span>
    <input type="button" value="❎" onclick="removeQA(event)">
</div>
<div class="qa qa_1">
    <img src="dog.png" alt="dog" data-answer="dog">
    <input type="text" name="text" class="text" oninput="fn(1);" value="dog">
    <span class="res"></span>
    <input type="button" value="❎" onclick="removeQA(event)">
</div>
</div>
<script>
const removeQA = (EVENT) => EVENT.target.parentElement.outerHTML = "";
// const dce = (ELEMENT_STR) => document.createElement(ELEMENT_STR);
// const dceWITHsa = (ELEMENT_STR, NAME_VAL_ARY) => {
//     let ELEMENT = document.createElement(ELEMENT_STR);
//     NAME_VAL_ARY.forEach(NAME_VAL => ELEMENT.setAttribute(NAME_VAL[0], NAME_VAL[1]) );
//     return ELEMENT;
// }
// const ac = (TARGET_ELEMENT_STR, ELEMENT) => document.querySelector(TARGET_ELEMENT_STR).appendChild(ELEMENT);

// document.createElement("div");
// https://developer.mozilla.org/en-US/docs/Web/API/Element/setAttribute
// ac("div.parent", document.createElement("div.child"));


const nameInsert = () => document.querySelector(".answer").value = Array.from(document.querySelector("input[type=file]").files).map(V => V.name).join("\n");

const fn = (EVENT) => {
    const parentClassString = ".qa_" + EVENT.toString();
    // console.log(parentClassString);
    const parentClassElement = document.querySelector(parentClassString);
    // console.log(parentClassElement);
    parentClassElement.querySelector(`.res`).textContent =
        parentClassElement.querySelector(`.text`).value === parentClassElement.querySelector(`img`).dataset.answer ? "🙆‍♀️" : "🙅‍♀️";
}
const init0 = () => document.querySelectorAll(`.text`)[0].value = "cat";
const init1 = () => document.querySelectorAll(`.text`)[1].value = "dog";

// https://developer.mozilla.org/en-US/docs/Web/API/File/Using_files_from_web_applications#example_using_object_urls_to_display_images
const imageUpload = (INT_NUM) => {
    if(document.querySelector("input[type=file]").files[0] === undefined){
        document.querySelector(".answer").placeholder = "select image";
        return;
    }

    // document.querySelector(".qa_" + INT_NUM.toString()).querySelector("img").src = URL.createObjectURL(document.querySelector("input[type=file]").files[0]);
    Array.from(document.querySelector("input[type=file]").files).forEach((FILE, IDX)=> document.querySelector(".qa_" + (INT_NUM + IDX).toString()).querySelector("img").src = URL.createObjectURL(FILE) );
};
const makeQA = (NUM) => {
    // document.querySelector(".answer").value.split("\n") >= 2
    if(document.querySelector(".answer").value === ""){
        document.querySelector(".answer").placeholder = "input answer here";
        return;
    }
    return document.querySelector(".answer").value.split("\n").map((ANSWER,IDX)=>{
    return `<div class="qa qa_${NUM+IDX}">
<img src="${ANSWER}.png" alt="${ANSWER}" data-answer="${ANSWER}">
<input type="text" name="text" class="text" oninput="fn(${NUM + IDX});" value="${ANSWER}">
<span class="res"></span>
<input type="button" value="❎" onclick="removeQA(event)">
</div>`
    }).join("")
};
const addQA = () => {
    // let answerTextArray = Array.from(document.querySelectorAll(".qa > .text")).map(V => V.value);
    const NUM = document.querySelector(".parent_qa").querySelectorAll(".qa").length;
    document.querySelector(".parent_qa").innerHTML +=
        makeQA(NUM)
            || "";
    // document.querySelectorAll(".qa > .text").forEach((V, IDX) => V.value = answerTextArray[IDX]);
    imageUpload(NUM);
    // fn(NUM);
    checkAllQA();
    // Array.from(document.querySelectorAll(".qa > .text")).map(V => V.value) = answerTextArray;
};

let answerTextArray = [];
const removeAnswerText = () => {
    answerTextArray = Array.from(document.querySelectorAll(".qa > .text")).map(V => V.value);
    Array.from(document.querySelectorAll(".qa > .text")).forEach(V => V.value = "");
}
const unRemoveAnswerText = () => document.querySelectorAll(".qa > .text").forEach((V, IDX) => V.value = answerTextArray[IDX]);


const checkAllQA = () => document.querySelectorAll(".qa > .text").forEach((V,IDX) => fn(IDX));

const removeOrUnremoveAndCheckAllQA = (EVENT) => {
    EVENT.target.dataset.removed === "removed" ? unRemoveAnswerText() : removeAnswerText();
    EVENT.target.dataset.removed === "removed" ? EVENT.target.dataset.removed = "" : EVENT.target.dataset.removed = "removed";
    checkAllQA();
};

const removeAllQA = () => {
    if(window.confirm("REMOVE ALL????")) {
        document.querySelectorAll(".qa").forEach(ELM => ELM.innerHTML = "")
    }
};



// init0();
// init1();
// fn(0);
// fn(1);
checkAllQA();
</script>
</body>
</html>