<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>crud</title>
</head>
<body>
    <div class="data"></div>
    <input type="text" class="info" required>
    <button onclick="insert();">insert</button>
    <button onclick="readall();">readall</button>
    <button onclick="dataList();">dataList</button>
    <ul class="dataListParent"></ul>
    
</body>
<script>
    const endpoint = "https://marred-mint-art.glitch.me/";
    const editLocalData = (param) => document.querySelector(".data").textContent = param;

    const exe = async (param) => {
        const prm  = param || "";
        const endpointWithPrm = endpoint + prm;
        let foo = await fetch(endpointWithPrm);
        let bar = await foo.json();
        return await bar;
    };
    let res;
    const readall = async () => {
        res = await exe("readall");
        await editLocalData(res);
    };
    const insert = async () => {
        if(document.querySelector(".info").value){
            res = await exe(`insert?info=${document.querySelector(".info").value}`);
            await editLocalData(JSON.stringify(res));
        }else{
            throw new Error('ðŸ’©');
        }
    };
    const deleteid = async (event) => {
        if(event.target.dataset.id){
            res = await exe(`deleteid?id=${event.target.dataset.id}`);
            await dataList();
            await editLocalData(JSON.stringify(res));
        }else{
            throw new Error('ðŸ’©');
        }
    };
    const makeListHtml = async() => {
        const tmp = await exe("readall");
        const result = await tmp.data.map(V=>`<li class="dataListChild" data-id=${V.id} onclick="deleteid(event)">${V.info}</li>`).join("");
        return result;
    };
    const dataList = async() => document.querySelector(".dataListParent").innerHTML = await makeListHtml();
</script>




<script class="glitchcom_serverjs">
const express = require('express');
// const app = express();
// const https = require('https');
// const fs = require('fs');
// const Database = require('better-sqlite3');
// const db = new Database('.data/tmp.sqlite3', { verbose: console.log });
// var HTTP_PORT = 8000
// app.listen(HTTP_PORT, () => {
//     console.log("Server running on port %PORT%".replace("%PORT%", HTTP_PORT))
// });
// function allowOrigin(res){
//   res.header("Access-Control-Allow-Origin", "*");
//   res.header("Access-Control-Allow-Headers", "Origin, X-Requested-With, Content-Type, Accept");  
// }
// app.get('/', function (req, res) {
//   allowOrigin(res);
//   res.json(
//     "this is response text"
//   )
// });
// app.get("/insert", (req, res, next) => {
//     allowOrigin(res);
//     const info = req.query.info;
//     db.prepare('INSERT INTO lorem (info) values(?)').run(info);
//     res.json({
//         "message": "success"
//         ,
//         "data": req.query.info
//     })
// });
// app.get("/readall", (req, res, next) => {
//   allowOrigin(res);
//   const table = db.prepare('SELECT * FROM lorem').all();
//     res.json({
//         "message": "success"
//         ,
//         "data": table
//     })
// });
// app.get("/deleteid", (req, res, next) => {
//     allowOrigin(res);
//     const id = req.query.id;
//     db.prepare('DELETE FROM lorem WHERE id = (?)').run(id);
//     const table = db.prepare('SELECT * FROM lorem').all();
//     res.json({
//         "message": "success"
//         ,
//         "data": table
//         // ,"deleteid": req.query.id
//     })
// });
</script>
<script class="glitchcom_sqljs">
const Database = require('better-sqlite3');
// const db = new Database('.data/tmp.sqlite3', { verbose: console.log });
// function CREATETABLE(){
//     db.prepare(`CREATE TABLE lorem(
// info TEXT NOT NULL
// )`).run();
// }
// function DROPTABLE(){
//     db.prepare(`DROP TABLE lorem`).run();
// }
// const table = db.prepare('SELECT * FROM lorem').all();
// console.log(table);
<script>
</html>